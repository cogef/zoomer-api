service: zoomer
# app and org for use with dashboard.serverless.com
app: zoomer
org: cogef

# You can pin your service to only deploy with a specific Serverless version
# Check out our docs for more details
frameworkVersion: '2'

plugins:
  - serverless-plugin-typescript
  - serverless-dotenv-plugin

custom:
  firebaseName: zoomer-300722

provider:
  name: aws
  runtime: nodejs12.x
  lambdaHashingVersion: 20201221
  region: us-east-2

  stage: prod
  apiName: ${self:service}-${opt:stage, self:provider.stage}

  httpApi:
    cors:
      allowedOrigins: '*'
      allowedHeaders: '*'
      allowedMethods: '*'
      allowCredentials: false
      maxAge: 6000 # In seconds
    authorizers:
      zoomerJwtAuthorizer:
        identitySource: $request.header.Authorization
        issuerUrl: https://securetoken.google.com/${self:custom.firebaseName}
        audience:
          - ${self:custom.firebaseName}

functions:
  api:
    handler: handler.api
    events:
      - httpApi:
          path: '*'
          method: '*'
          authorizer:
            name: zoomerJwtAuthorizer
      - httpApi:
          path: /{proxy+}
          method: 'OPTIONS'
